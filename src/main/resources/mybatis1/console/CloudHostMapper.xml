<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CloudHostMapper">
	
	<!--表名 -->
	<sql id="tableName">
		t_virtualmachine
	</sql>
	
	<!-- 字段 -->
	<sql id="Field">
		id,
		name,	
		ip,	
		cpu,	
		memory,	
		datadisk,	
		os,	
		status,
		platform,
		duedate
	</sql>
	
	<!-- 字段值 -->
	<sql id="FieldValue">
		#{id},
		#{name},
		#{ip},
		#{cpu},
		#{memory},
		#{datadisk},
		#{os},
		#{status},
		#{platform},
		#{duedate}
	</sql>
	
	<!-- 新增-->
	<insert id="save" parameterType="pd">
		insert into 
	<include refid="tableName"></include>
		(
	<include refid="Field"></include>
		) values (
	<include refid="FieldValue"></include>
		)
	</insert>
	
	<!-- 删除-->
	<delete id="delete" parameterType="pd">
		delete from
		<include refid="tableName"></include>
		where 
			FHSMS_ID = #{FHSMS_ID}
	</delete>
	
	<!-- 修改 状态-->
	<update id="edit" parameterType="pd">
		update
		<include refid="tableName"></include>
		set 
			STATUS = '1'
		where 
		SANME_ID = #{SANME_ID}
	</update>
	
	<!-- 通过ID获取数据 -->
	<select id="findById" parameterType="pd" resultType="pd">
		select 
		<include refid="Field"></include>
		from 
		<include refid="tableName"></include>
		where 
			FHSMS_ID = #{FHSMS_ID}
	</select>
	
	<!-- 列表 -->
	<select id="datalistPage" parameterType="page" resultType="pd">
		SELECT
			vm.id AS id,
			vm.name AS name,
			vm.ip AS ip,
			vm.cpu AS cpu,
			vm.memory AS memory,
			vm.datadisk AS datadisk,
			vm.os AS os,
			vm.status AS status,
			cp.name AS platform,
			date(vm.duedate) AS duedate
		FROM
			t_virtualmachine vm JOIN t_cloudplatform cp ON vm.platform = cp.id
		WHERE
			1 = 1
	</select>
	
	<!-- 列表(全部) -->
	<select id="listAll" parameterType="pd" resultType="pd">
		select
		<include refid="Field"></include>
		from 
		<include refid="tableName"></include>
	</select>
	
	<!-- 获取未读总数 -->
	<select id="findFhsmsCount" parameterType="String" resultType="pd">
		select 
			count(FHSMS_ID) fhsmsCount
		from 
		<include refid="tableName"></include>
		where 
			STATUS = '2'
		and
			TYPE = '1'
		and
			FROM_USERNAME = #{USERNAME} 
	</select>
	
	<!-- 批量删除 -->
	<delete id="deleteAll" parameterType="String">
		delete from
		<include refid="tableName"></include>
		where 
			FHSMS_ID in
		<foreach item="item" index="index" collection="array" open="(" separator="," close=")">
                 #{item}
		</foreach>
	</delete>
	
	<!-- fh313596790qq(青苔) -->
</mapper>